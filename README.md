# SS23_ADSP_TCF

An official repository for the "Tangible Climate Futures" project from the ADSP (SS23) course at TU Berlin.

Authors:

- Simon Albani
- Emil Balitzki
- Theodor Barkow
- Alexander Guttenberger
- Florian JÃ¤ger
- Frederik Stalschus

## Project Deployment

1. Install [Docker](https://docs.docker.com/engine/install/) and run the docker daemon.
2. Install Git and clone this repository (`git clone https://github.com/Corgam/SS23_ADSP_TCF`)
3. Inside the root folder run `npm run deploy`, which will deploy all necessary Docker containers (including FE, BE and all microservices).

- Frontend is hosted at `localhost:80`
- Backend Public API (Express.js) server is hosted at `localhost:40000`, with Swagger end-points documentation accessible at `localhost:40000/docs`.
- All microservices (and their containers) should not be accessible outside the main Public API service.

With the use of the Docker containers, the project can be deployed both locally and in the VM in a Cloud (either manually or with the use of the Terraform). For local developement use `npm run deploy:frontend` and `npm run deploy:backend` in two separate terminals.

## Deployment on GCP (with Terraform)

To deploy the complete application with terraform follow these steps ([Install Terraform](https://developer.hashicorp.com/terraform/downloads)):

1. Download the key to your system (be aware to not commit it) from [GCP](https://console.cloud.google.com/iam-admin/serviceaccounts/details/104857105655565907431/keys?project=adsp-387109&supportedpurview=project)
2. Set the environment variable `GOOGLE_APPLICATION_CREDENTIALS=/path/to/your/key.json`
3. Change to deploy directory with `cd deploy`
4. Setup your terraform environment with `terraform init`
5. Apply the infrastructure with `terraform apply`, you can access the app under the provided URL
6. Shutdown with `terraform destroy`

## Backend

The BE end-points are accessible at `localhost:40000/docs` after deploying the project (Swagger documentation) and the descriptions and examples for all JSON objects used by the BE can be found in [repositories' wiki](https://github.com/Corgam/SS23_ADSP_TCF/wiki).

Note: documents' IDs are automatically generated by MongoDB and provided when receiving the documents.

### Backend structure

The BE is built with a dockerized, RESTful layered (model, service, and controller), microservices architecture in mind, thus more microservices can be added easily by deploying further Docker containers.
All of the code is situated within the `backend` folder.
Additionally, BE uses TS interfaces specified in the `common/types` folder. BE folder structure:

- `public-api` contains all code for the main public API
  - `src` main source folder
    - `config` contains all config variables used by the public API code
    - `controllers` includes all routes logic and routing code
    - `errors` contains declaration of custom errors, used by the error middleware
    - `middlewares` contains all middleware layers used by the express server
    - `models` contains schemas for the databases
    - `services` contains the algorithms that fulfill the business requirements
  - `__test__` includes all unit tests for public API
- `data-science` contains all code for Python microservice
  - `app`
    - `controllers` includes all routes logic and routing code
    - `services` contains the algorithms that fulfill the business requirements
  - `config` contains all config variables used by the Python microservice code
  - `tests` includes all unit tests for Python microservice

## Front-End

### Frontend structure

All of the code is situated within the `frontend/src` folder.

- `app` includes the base application, routing logic, and module for the material-components
- `assets` includes pictures, external icons, ...
- `core` contains essential logic for user access management, shared services
- `lib` contains the high-level components (such as pages) and components which are used ones
- `shared` contains low-level components, which are shared accross different components, such as the map or tables

## Useful Scripts for MongoDB

Once the project is set up with the MongoDB container, you can execute some helpful scripts:

### Dependencies

To ensure successful execution of the script, please make sure you have the following dependencies installed:

- Python 3.x: Ensure that you have Python 3.x installed on your system. You can download it from the official Python website: [python.org](https://www.python.org/).
- PyMongo: This library provides a Python interface for connecting to and interacting with MongoDB. You can find more information on the [official site](https://www.mongodb.com/docs/drivers/pymongo/).
- Faker: Faker is a Python library used for generating fake data, such as names, addresses, phone numbers, and more. It is utilized in this script to create realistic-looking data. You can find the library on [GitHub](https://github.com/joke2k/faker).
- You can install both dependencies using pip:

```
pip install pymongo faker
```

- MongoDB: Make sure you have the MongoDB instance running with the command `docker-compose up -d mongodb`.

### Seed the Database with Random Data

To seed the database with random data, use the following command:

```
python scripts/mongo/main.py seed
```

This command connects to `mongodb://localhost:27017/datastore` and adds 10 random documents. You can modify the default settings as follows:

```
python scripts/mongo/main.py seed --num-documents <int> --mongo-url <string>
```

For example:

```
python scripts/mongo/main.py seed --num-documents 20 --mongo-url mongodb://localhost:27017/mydatabase
```

### Cleanup the Database

To clean up the database, simply run the following command:

```
python scripts/mongo/main.py cleanup --mongo-url <string>
```

For example:

```
python scripts/mongo/main.py cleanup --mongo-url mongodb://localhost:27017/mydatabase
```
